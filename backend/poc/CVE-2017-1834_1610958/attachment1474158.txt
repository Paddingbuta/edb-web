#!/usr/bin/env stap

probe begin {
        printk(6, "Mitigation for CVE-2017-18344 loaded.\n");
}


probe end {
        printk(6, "Mitigation for CVE-2017-18344 unloaded.\n");
}


// You can't read what you can't open. 
probe kernel.function("proc_timers_open@fs/proc/base.c").return { 
	$return = -13;
        message = sprintf("CVE-2017-18344 mitigation denied access to %s to %s(%d)", file_name , execname(), pid());
        printk(6, message);
}

