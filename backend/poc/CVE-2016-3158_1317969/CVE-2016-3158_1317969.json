{
    "bugid": "1317969",
    "cveid": [
        "CVE-2016-3158",
        "CVE-2016-3159"
    ],
    "summary": "CVE-2016-3158 CVE-2016-3159 xen: AMD FPU FIP/FDP/FOP leak workaround broken (XSA-172)",
    "alias": "CVE-2016-3158, CVE-2016-3159, xsa172",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "",
    "reported_date": "2016-03-15 16:10 UTC byAndrej Nemec",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=1136653"
    ],
    "comment": [
        "ISSUE DESCRIPTION\n=================\n\nThere is a workaround in Xen to deal with the fact that AMD CPUs don't\nload the x86 registers FIP (and possibly FCS), FDP (and possibly FDS),\nand FOP from memory (via XRSTOR or FXRSTOR) when there is no pending\nunmasked exception.\n\nHowever, this workaround does not cover all possible input cases.\nThis is because writes to the hardware FSW.ES bit, which the current\nworkaround is based on, are ignored; instead, the CPU calculates\nFSW.ES from the pending exception and exception mask bits.  Xen\ntherefore needs to do the same.\n\nNote that part of said workaround was the subject of XSA-52.\n\nIMPACT\n======\n\nA malicious domain may be able to leverage this to obtain sensitive\ninformation such as cryptographic keys from another domain.\n\nVULNERABLE SYSTEMS\n==================\n\nXen versions 4.0 and onwards are vulnerable.  Any kind of guest can\nexploit the vulnerability.\n\nThe vulnerability is exposed only on AMD x86 systems.  Intel and ARM\nsystems do not expose this vulnerability.\n\nBoth PV and HVM guests are affected.\n\nMITIGATION\n==========\n\nThe vulnerability can be avoided if the guest kernel is controlled by\nthe host rather than guest administrator, provided that further steps\nare taken to prevent the guest administrator from loading code into\nthe kernel (e.g. by disabling loadable modules etc) or from using\nother mechanisms which allow them to run code at kernel privilege.\n\nOn Xen versions 4.3 and earlier, turning off XSAVE support via the\n\"no-xsave\" hypervisor command line option will avoid the vulnerability.\n\nOn Xen versions 4.4 and onwards there is no other known mitigation.",
        "Createdattachment 1136653[details]upstream patch\n\nThis patch covers versions:\n\nxen-unstable, Xen 4.6.x, Xen 4.5.x, Xen 4.4.x",
        "Acknowledgments:\n\nName: the Xen project",
        "UPDATES IN VERSION 2\n====================\n\nCVEs assigned.\n\nImpact is less severe than previously thought: sensitive information\nis very unlikely to reside in the leaked registers.\n\nNOTE REGARDING CVE\n==================CVE-2016-3158is for the code change which is required for all\nversions (but which is sufficient only on Xen 4.3.x, and insufficient\non later versions).  Ie for the second hunk in xsa172.patch (the only\nhunk in xsa172-4.3.patch), which patches the function xrstor.CVE-2016-3159is for the code change which is applicable for later\nversions only, but which must always be combined with the code change\nforCVE-2016-3158.  Ie for the first hunk in xsa172.patch, which\npatches the function fpu_fxrstor.",
        "External Reference:http://xenbits.xen.org/xsa/advisory-172.html",
        "Created xen tracking bugs for this issue:\n\nAffects: fedora-all [bug 1321944]",
        "xen-4.5.3-1.fc22 has been pushed to the Fedora 22 stable repository. If problems still persist, please make note of it in this bug report.",
        "xen-4.5.3-1.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.",
        "Statement:\n\nThis issue does not affect the Xen hypervisor packages as shipped with Red Hat Enterprise Linux 5."
    ]
}