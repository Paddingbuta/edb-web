#include <errno.h>
#include <pwd.h>
#include <grp.h>
#include <stdio.h>
#include <stdlib.h>

int
main(int argc, char **argv)
{
	size_t length = (argc > 2) ? atol(argv[2]) : 4;
	const char *user = (argc > 1) ? argv[1] : "root";
	char *buf = malloc(length);
	struct passwd pwd, *pw;
	int ret;

	pw = NULL;
	ret = getpwnam_r(user, &pwd, buf, length, &pw);
	printf("returned %d, errno = %d, pointer %p, buffer %p\n",
	       ret, errno, pw, &pwd);
	if (pw == &pwd) {
		putpwent(pw, stdout);
	}
	return 0;
}
