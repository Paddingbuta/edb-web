{
    "bugid": "719228",
    "cveid": [
        "CVE-2011-2521"
    ],
    "summary": "CVE-2011-2521 kernel: perf, x86: fix Intel fixed counters base initialization",
    "alias": "CVE-2011-2521",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "",
    "reported_date": "2011-07-06 06:02 UTC byEugene Teo (Security Response)",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=536208"
    ],
    "comment": [
        "The following patch solves the problems introduced by Robert's commit 41bf498 and reported by Arun Sharma. This commit gets rid of the base + index notation for reading and writing PMU msrs.\n\nThe problem is that for fixed counters, the new calculation for the base did not take into account the fixed counter indexes, thus all fixed counters were read/written from fixed counter 0.  Although all fixed counters share the same config MSR, they each have their own counter register.\n\nWithout:\n\n $ task -e unhalted_core_cycles -e instructions_retired -e baclears noploop 1 noploop for 1 seconds\n\n  242202299 unhalted_core_cycles (0.00% scaling, ena=1000790892, run=1000790892)\n 2389685946 instructions_retired (0.00% scaling, ena=1000790892, run=1000790892)\n      49473 baclears             (0.00% scaling, ena=1000790892, run=1000790892)\n\nWith:\n\n $ task -e unhalted_core_cycles -e instructions_retired -e baclears noploop 1 noploop for 1 seconds\n\n 2392703238 unhalted_core_cycles (0.00% scaling, ena=1000840809, run=1000840809)\n 2389793744 instructions_retired (0.00% scaling, ena=1000840809, run=1000840809)\n      47863 baclears             (0.00% scaling, ena=1000840809, run=1000840809)\n\nAcknowledgements:\n\nRed Hat would like to thank Li Yu for reporting this issue.",
        "Upstream commit:http://git.kernel.org/linus/fc66c5210ec2539e800e87d7b3a985323c7be96eIntroduced in:http://git.kernel.org/linus/41bf498949a263fa0b2d32524b89d696ac330e94",
        "Statement:\n\nThis issue did not affect the versions of Linux kernel as shipped with Red Hat Enterprise Linux 4, 5, and Red Hat Enterprise MRG as they did not backport the upstream commit 41bf498 that introduced the issue. This has been addressed in Red Hat Enterprise Linux 6 viahttps://rhn.redhat.com/errata/RHSA-2011-1350.html.",
        "***Bug 717049has been marked as a duplicate of this bug. ***",
        "***Bug 721283has been marked as a duplicate of this bug. ***",
        "------- Comment From ranittal.ibm.com 2011-10-03 08:44 EDT-------\nHi Don,\n\nDo we have any update on this? Can you please confirm which build would include this fix?\n\nThanks.",
        "This issue has been addressed in following products:\n\n  Red Hat Enterprise Linux 6\n\nVia RHSA-2011:1350https://rhn.redhat.com/errata/RHSA-2011-1350.html",
        "Created kernel tracking bugs for this issue\n\nAffects: fedora-all [bug 748669]",
        "------- Comment From nabharay.com 2011-11-25 06:47 EDT-------\nWhile running pounder test on HS22 with RHEL 6.2 RC1 64 bit , the machine got crashed after 44 hours of test run and vmcore was generated. The backtrace of the vmcore is same as the mentioned in the bug description.\n\n---uname ouptut----\n\nLinux hs22.in.ibm.com 2.6.32-220.el6.x86_64 #1 SMP Wed Nov 9 08:03:13 EST 2011 x86_64 x86_64 x86_64 GNU/Linux\n\nMachine Type = HS22\n\nAttaching the crash report and sos report.\n\nI am pasting the back trace below:\n\nThis GDB was configured as \"x86_64-unknown-linux-gnu\"...\n\nKERNEL: /usr/lib/debug/lib/modules/2.6.32-220.el6.x86_64/vmlinux\nDUMPFILE: /var/crash/127.0.0.1-2011-11-25-07:20:47/vmcore  [PARTIAL DUMP]\nCPUS: 16\nDATE: Fri Nov 25 07:18:47 2011\nUPTIME: 1 days, 20:33:37\nLOAD AVERAGE: 190.73, 316.30, 344.43\nTASKS: 776\nNODENAME: hs22.in.ibm.com\nRELEASE: 2.6.32-220.el6.x86_64\nVERSION: #1 SMP Wed Nov 9 08:03:13 EST 2011\nMACHINE: x86_64  (2666 Mhz)\nMEMORY: 70 GB\nPANIC: \"Kernel panic - not syncing: Watchdog detected hard LOCKUP on cpu 13\"\nPID: 2016\nCOMMAND: \"timed_loop\"\nTASK: ffff880a9eb20b00  [THREAD_INFO: ffff8800623ee000]\nCPU: 13\nSTATE: TASK_RUNNING (PANIC)\n\ncrash> bt\nPID: 2016   TASK: ffff880a9eb20b00  CPU: 13  COMMAND: \"timed_loop\"\n#0 [ffff8808234a7b00] machine_kexec at ffffffff81031fcb\n#1 [ffff8808234a7b60] crash_kexec at ffffffff810b8f72\n#2 [ffff8808234a7c30] panic at ffffffff814ec348\n#3 [ffff8808234a7cb0] watchdog_overflow_callback at ffffffff810d8fad\n#4 [ffff8808234a7cd0] __perf_event_overflow at ffffffff8110a89d\n#5 [ffff8808234a7d70] perf_event_overflow at ffffffff8110ae54\n#6 [ffff8808234a7d80] intel_pmu_handle_irq at ffffffff8101e096\n#7 [ffff8808234a7e90] perf_event_nmi_handler at ffffffff814f09f9\n#8 [ffff8808234a7ea0] notifier_call_chain at ffffffff814f2545\n#9 [ffff8808234a7ee0] atomic_notifier_call_chain at ffffffff814f25aa\n#10 [ffff8808234a7ef0] notify_die at ffffffff81096bce\n#11 [ffff8808234a7f20] do_nmi at ffffffff814f01c3\n#12 [ffff8808234a7f50] nmi at ffffffff814efad0\n[exception RIP: _spin_lock_irqsave+47]\nRIP: ffffffff814ef22f  RSP: ffff8800623ef928  RFLAGS: 00000083\nRAX: 0000000000008c60  RBX: ffff880800033db8  RCX: 0000000000008c54\nRDX: 0000000000000282  RSI: 0000000000000001  RDI: ffff880800033db8\nRBP: ffff8800623ef928   R8: 0000000000000002   R9: 00000000000030e6\nR10: 0000000000000001  R11: 0000000000000000  R12: ffff880800000040\nR13: 0000000000000001  R14: 0000000000000001  R15: 0000000000000000\nORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0000\n--- <NMI exception stack> ---\n#13 [ffff8800623ef928] _spin_lock_irqsave at ffffffff814ef22f\n#14 [ffff8800623ef930] __wake_up at ffffffff810517f2\n#15 [ffff8800623ef970] wakeup_kswapd at ffffffff811295ae\n#16 [ffff8800623ef9b0] __alloc_pages_nodemask at ffffffff81123e5b\n#17 [ffff8800623efad0] alloc_pages_current at ffffffff81158b7a\n#18 [ffff8800623efb00] __page_cache_alloc at ffffffff81110e57\n#19 [ffff8800623efb30] __do_page_cache_readahead at ffffffff81126a7b\n#20 [ffff8800623efbc0] ra_submit at ffffffff81126bd1\n#21 [ffff8800623efbd0] filemap_fault at ffffffff81112123\n#22 [ffff8800623efc40] __do_fault at ffffffff8113b2c4\n#23 [ffff8800623efcd0] handle_pte_fault at ffffffff8113b877\n#24 [ffff8800623efdb0] handle_mm_fault at ffffffff8113c4b4\n#25 [ffff8800623efe00] __do_page_fault at ffffffff81042b39\n#26 [ffff8800623eff20] do_page_fault at ffffffff814f248e\n#27 [ffff8800623eff50] page_fault at ffffffff814ef845\nRIP: 00000036c824e950  RSP: 00007fff4c167988  RFLAGS: 00010246\nRAX: 0000000000000000  RBX: 00000000020d9010  RCX: 00007fff4c16928a\nRDX: 0000000000401389  RSI: 0000000000000100  RDI: 00007fff4c167990\nRBP: 00007fff4c1680ec   R8: 000000000000ffff   R9: 000000000000000f\nR10: fffffffffffff38f  R11: 0000000000000000  R12: 00007fff4c168208\nR13: 00000000004012e0  R14: 00007fff4c168218  R15: 0000000000004093\nORIG_RAX: ffffffffffffffff  CS: 0033  SS: 002b\n\nThis is a regression from RHEL 6.2 SNAP3 or SNAP4.\n\nThanks",
        "Createdattachment 536207[details]Sosreportcomment #17------- Comment on attachment From nabharay.com 2011-11-25 06:49 EDT-------\n\n\nSosreportcomment #17",
        "Createdattachment 536208[details]Crash reportcomment #17------- Comment on attachment From nabharay.com 2011-11-25 06:51 EDT-------\n\n\nCrash report as mentioned incomment #17",
        "- [kernel] perf: Optimize event scheduling locking (Steve Best) [744986]\n\nis the only patch that may have caused this regression since \nsnap3/4.",
        "Linda,\n\nI'm not sure why bzs are getting dupped to this bz. checking out kernel 220 it has\nUpstream commit:http://git.kernel.org/linus/fc66c5210ec2539e800e87d7b3a985323c7be96eanyone have any idea why this is still open? I assume it is for RHEL 6.2, maybe it is for another RHEL 6.x release?\n\n-Steve",
        "(In reply tocomment #19)> Linda,\n> \n> I'm not sure why bzs are getting dupped to this bz. checking out kernel 220 it\n> has\n> Upstream commit:\n>http://git.kernel.org/linus/fc66c5210ec2539e800e87d7b3a985323c7be96e> \n> anyone have any idea why this is still open? I assume it is for RHEL 6.2, maybe\n> it is for another RHEL 6.x release?\n> \n> -SteveThis is a top-level security bug. It is meant to keep track of the trackers (see Depends on). This will remain opened until all the trackers have been addressed, including rhel-6.2. Thanks.",
        "------- Comment From tpnoonan.com 2012-04-25 11:32 EDT-------\n(In reply tocomment #21)\n------- Comment From> eteo 2011-12-01 00:17:36 EDT-------\n> I'm not sure why bzs are getting dupped to this bz. checking out\n> kernel 220 it>\n>> anyone have any idea why this is still open? I assume it is for RHEL 6.2,\n> maybe>\n\nThis is a top-level> security bug. It is meant to keep track of the trackers (see Depends on).\n> This will remain opened until all the trackers have been addressed,\n> including rhel-6.2. Thanks.hi red hat, have all the trackers been addressed/can this one now be closed? thanks",
        "(In reply tocomment #21)> ------- Comment From tpnoonan.com 2012-04-25 11:32 EDT-------\n> hi red hat, have all the trackers been addressed/can this one now be closed?Hi IBM, yes, closing."
    ]
}