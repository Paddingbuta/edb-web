#!/usr/bin/stap -vvvv

global in_rt_garbage_collect

probe kernel.function("rt_garbage_collect") {
	printf("Entering rt_garbage_collect\n");
	in_rt_garbage_collect = 1;
}

probe kernel.function("rt_garbage_collect").return {
	printf("Leaving rt_garbage_collect\n");
	in_rt_garbage_collect = 0;
}


probe kernel.function("rt_free") {
	if (in_rt_garbage_collect == 1)
		printf("Freeing route");
}

probe kernel.function("ip_mkroute_input") {
	printf("Making route on input\n");
}

probe kernel.function("ip_mkroute_output") {
	printf("Making route on output\n");
}

probe kernel.function("ip_rt_redirect") {
	printf("in ip_rt_redirect\n");
}

probe kernel.function("rt_intern_hash").return {
	printf("In rt_intern_hash\n");
	if ($return != 0)
		printf("Failed route cache entry with rc %d\n", $return);
}

