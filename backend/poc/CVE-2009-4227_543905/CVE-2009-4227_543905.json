{
    "bugid": "543905",
    "cveid": [
        "CVE-2009-4227",
        "CVE-2009-4228"
    ],
    "summary": "CVE-2009-4227 CVE-2009-4228 Xfig, Transfig: Stack-based buffer overflow by loading malformed .FIG files",
    "alias": "CVE-2009-4227, CVE-2009-4228",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559274",
    "reported_date": "2009-12-03 13:25 UTC byJan Lieskovsky",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=375778"
    ],
    "comment": [
        "PEDAMACHEPHEPTOLIONES and D.B. COOPER found a stack-based buffer\noverflow, present in Xfig, Transfig by loading malformed .FIG files.\nA remote attacker could provide a specially-crafted .FIG text\nobject file, which once opened by a local, unsuspecting user would\nlead to denial of service (Xfig, fig2dev crash).\n\nReferences:\n-----------http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559274Fortran PoC by PEDAMACHEPHEPTOLIONES:\n-------------------------------------http://bugs.debian.org/cgi-bin/bugreport.cgi?msg=5;filename=xfig_poc.f;att=1;bug=559274CVE was requested here:\n-----------------------http://www.openwall.com/lists/oss-security/2009/12/03/2",
        "Createdattachment 375778[details]Local copy of Fortran Xfig PoC from PEDAMACHEPHEPTOLIONES, D.B. COOPER",
        "This issue do NOT affect the versions of the xfig and transfig packages,\nas shipped with Red Hat Enterprise Linux 3.\n\nThis issue affects the versions of the xfig and transfig packages,\nas shipped with Red Hat Enterprise Linux 4 and 5.\n\nThis issue affects the versions of the xfig and transfig packages,\nas shipped with Fedora release of 10, 11, 12 and Fedora Rawhide.",
        "Createdattachment 376059[details]PATCH: fixing this for xfig\n\nHere is a proposed patch for xfig-3.2.5b, which fixes this overflow. Note that\nafter this xfig will still crash on plane.fig, going into a recursive function call loop inside u_bound.c, till it exceeds its maximum stack size.\n\nThis may caused be caused by the use of an uninitialzed variable\nresolution (for 1.3 files) inside f_read.c:readfp_fig() when calling\nscale_figure().\n\nGiven that this other bug has lingered for quite a long while, I'm wondering\nif 1.3 format support is still functional at all, and if it would not be\nbetter to simply disable it ?\n\nCan anyone provide me with some valid 1.3 format files to see how much work it will be to fix 1.3 format support ?",
        "The CVE identifiers ofCVE-2009-4227andCVE-2009-4228has been assigned\nfor Xfig by MITRE:\n\n---------------------------------------------------------------------------\n\na,CVE-2009-4227Stack-based buffer overflow in the read_1_3_textobject function in\nf_readold.c in Xfig 3.2.5b and earlier, and in the read_textobject\nfunction in read1_3.c in fig2dev in Transfig 3.2.5a and earlier,\nallows remote attackers to execute arbitrary code via a long string in\na malformed .fig file that uses the 1.3 file format.  NOTE: some of\nthese details are obtained from third party information.\n\nReferences:\n-----------http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-4227http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559274http://www.securityfocus.com/bid/37193http://secunia.com/advisories/37571http://secunia.com/advisories/37577http://xforce.iss.net/xforce/xfdb/54525---------------------------------------------------------------------------\n\nb,CVE-2009-4228Stack consumption vulnerability in u_bound.c in Xfig 3.2.5b and\nearlier allows remote attackers to cause a denial of service\n(application crash) via a long string in a malformed .fig file that\nuses the 1.3 file format, possibly related to the readfp_fig function\nin f_read.c.\n\nReferences:\n-----------http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-4228http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=559274",
        "This should not affect Fedora 11 or higher at all.  The stack protection bits are doing their job, as noted by:\n\n% xfig plane.fig|head\nzsh: correct 'xfig' to '_xfig' [nyae]? n\n*** stack smashing detected ***: xfig-Xaw3d terminated\n======= Backtrace: ========= \n/lib64/libc.so.6(__fortify_fail+0x37)[0x3b2d4f6ea7]\n/lib64/libc.so.6(__fortify_fail+0x0)[0x3b2d4f6e70]\n...\n\nLikewise, the spec in Fedora uses:\n\nmake XFIGDOCDIR=%{_docdir}/%{name}-%{version} \\\n     CDEBUGFLAGS=\"$RPM_OPT_FLAGS -D_GNU_SOURCE -fno-strength-reduce -fno-strict-aliasing\"\n\nand:\n\n% strings /usr/bin/xfig-Xaw3d|grep stack\n__stack_chk_fail\n\nBy rights this should affect Fedora 10 since %optflags does not have -fstack-protector, but the results of running the proof of concept are the same (stack smashing detected), and strings should __stack_chk_fail is present so I'm not quite sure why this is aborted on Fedora 10.",
        "The Red Hat Security Response Team has rated this issue as having moderate security impact, a future update may address this flaw.  More information regarding issue severity can be found here:http://www.redhat.com/security/updates/classification/",
        "Created transfig tracking bugs for this issue\n\nAffects: fedora-all [bug 845605]",
        "Created xfig tracking bugs for this issue\n\nAffects: fedora-all [bug 845606]",
        "(In reply tocomment #12)> Created xfig tracking bugs for this issue\n> \n> Affects: fedora-all [bug 845606]Fixed for Fedora-16 - Fedora-18 & rawhide, updates for Fedora-16 & Fedora-17 are here:https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc16https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc17",
        "(In reply tocomment #16)> (In reply tocomment #12)\n> > Created xfig tracking bugs for this issue\n> > \n> > Affects: fedora-all [bug 845606]\n> \n> Fixed for Fedora-16 - Fedora-18 & rawhide, updates for Fedora-16 & Fedora-17\n> are here:\n>https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc16>https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc17Should notbug #845606reflect that then and be closed?",
        "(In reply tocomment #17)> > Fixed for Fedora-16 - Fedora-18 & rawhide, updates for Fedora-16 & Fedora-17\n> > are here:\n> >https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc16> >https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc17> \n> Should notbug #845606reflect that then and be closed?It will be automatically closed by bodhi once the update has been moved from updates-testing to the regular (stable)  updates repository.",
        "(In reply tocomment #18)> > >https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc16> > >https://admin.fedoraproject.org/updates/xfig-3.2.5-32.b.fc17> > \n> > Should notbug #845606reflect that then and be closed?\n> \n> It will be automatically closed by bodhi once the update has been moved from\n> updates-testing to the regular (stable)  updates repository.Those two update request do not referencebug #845606, so it will not be auto-closed when updates are pushed to stable.  It will need to be added to the bug list to have it closed.",
        "(In reply tocomment #19)> > It will be automatically closed by bodhi once the update has been moved from\n> > updates-testing to the regular (stable)  updates repository.\n> \n> Those two update request do not referencebug #845606, so it will not be\n> auto-closed when updates are pushed to stable.  It will need to be added to\n> the bug list to have it closed.Ah yes, my bad, fixed now.",
        "xfig-3.2.5-32.b.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report.",
        "xfig-3.2.5-32.b.fc16 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report.",
        "transfig-3.2.5d-7.fc17 has been pushed to the Fedora 17 stable repository.  If problems still persist, please make note of it in this bug report.",
        "transfig-3.2.5d-4.fc16 has been pushed to the Fedora 16 stable repository.  If problems still persist, please make note of it in this bug report.",
        "Not planned to be fixed in future Red Hat Enterprise Linux updates."
    ]
}