{
    "bugid": "404291",
    "cveid": [
        "CVE-2007-6282"
    ],
    "summary": "CVE-2007-6282 IPSec ESP kernel panics",
    "alias": "CVE-2007-6282",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "",
    "reported_date": "2007-11-29 11:50 UTC byDirk Nehring",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=272881"
    ],
    "comment": [
        "Description of problem:\nWe find out that various kernel versions (2.6.18-xxx) does crash with IPSec. \nThis situation occurs with special clients (netscreen firewall, Cisco PIX) and \ncan repoduced on various platforms. We have an example stacktrace here.\n\nThe bug is located in the kernel, not in the tools. We exchange the ipsec-\ntools, no change.\n\nVersion-Release number of selected component (if applicable):\n2.6.18-x (all versions)\n\nHow reproducible:\nVery difficult, since it only occurs after some time (30min - 3 days) and only \nwith netscreen firewalls or Cisco PIX.\n\nSteps to Reproduce:\n1. Using ipsec-tools and configure tunnels\n2. wait...\n3.\n  \nActual results:\n\n\nExpected results:\n\n\nAdditional info:\n\nI have also a compressed crashdump if anyone need (18 MB compressed...)",
        "Createdattachment 272881[details]Example panic from a VM (happens also with physically machines!!!)",
        "It turns out that this bug is a crasher FOR ALL 2.6.x kernel, including all\nRHEL, Fedora, and pristine kernels! Herbert was informed via security\nabout this bug, it is a fragmentation problem (if the ESP header is fragmented\nbefore the iv ends, BUG() is called).\n\nHere is the fix:\n\ndiff --git a/net/ipv4/esp4.c b/net/ipv4/esp4.c\nindex 1738113..0f307f1 100644\n--- a/net/ipv4/esp4.c\n+++ b/net/ipv4/esp4.c\n@@ -165,7 +165,7 @@ static int esp_input(struct xfrm_state *x, struct sk_buff *skb)\n        int padlen;\n        int err;\n\n-       if (!pskb_may_pull(skb, sizeof(*esph)))\n+       if (!pskb_may_pull(skb, sizeof(*esph) + esp->conf.ivlen))\n                goto out;\n\n        if (elen <= 0 || (elen & (blksize-1)))\ndiff --git a/net/ipv6/esp6.c b/net/ipv6/esp6.c\nindex 4440532..d993fa0 100644\n--- a/net/ipv6/esp6.c\n+++ b/net/ipv6/esp6.c\n@@ -155,7 +155,7 @@ static int esp6_input(struct xfrm_state *x, struct sk_buff *skb)\n        int nfrags;\n        int ret = 0;\n\n-       if (!pskb_may_pull(skb, sizeof(*esph))) {\n+       if (!pskb_may_pull(skb, sizeof(*esph) + esp->conf.ivlen)) {\n                ret = -EINVAL;\n                goto out;\n        }\n\nMy collegue Andreas Ferber is currently writing a CVS,CVE-2007-6282.",
        "Hi,\n\nany updates on this issue? Without this patch, every 2.6 kernel can crash with \nonly one fragmented packet.\n\nDirk",
        "Hi Dirk,\n\nSorry for the delay and thanks for the ping. I've just posted an updated patch\nto netdev again a few minutes ago and davem already merged it. It seems that the\noriginal patch posted earlier did not apply as the new aead interface changed\nhow the ivsize is accessed. Somehow updating the patch to use the new interface\ngot lost in the cracks.\n\nMuchas gracias again.",
        "Createdattachment 299408[details]patch as merged upstream",
        "http://marc.info/?l=linux-netdev&m=120372380411259&w=2http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=920fc941a9617f95ccb283037fe6f8a38d95bb69",
        "I am hearing a report that this patch breaks ESP when used with openswan.",
        "It seems the report was made on a kernel < 2.6.18-92.el5. This version\nreportedly works fine.",
        "(In reply tocomment #13)> I am hearing a report that this patch breaks ESP when used with openswan.This maybe true here. After upgraded to 2.6.18-53.1.21.el5, the AT&T Global\nNetwork Client (mtsconnect - version 0.4 2004/08/24) broke on my machine. It\nuses IPsec to set up a VPN to connect to corporate intranet.\n\nI've to rollback to 2.6.18-53.1.19.el5 for this. Hope this can be fixed. If\nthere's anything I can help (testing or patch shooting, etc) please let me know.\nThanks!",
        "Same for us, we switched yesterday to the new version and our racoon IPsec-\ntunnels break! Currently we switched from .21 to .19, which works flawlessly.",
        "Regression for Red Hat Enterprise Linux 5 was resolved in the RHEL 5.2 kernel\npackages kernel-2.6.18-92.el5 and later.",
        "I can confirm that 2.6.18-92.el5 works."
    ]
}