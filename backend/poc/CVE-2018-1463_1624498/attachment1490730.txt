
probe kernel.function("do_prlimit") {
  if ($resource == @const("RLIMIT_STACK") && $new_rlim != 0)
    {
      l = @const("_STK_LIM")/4*3;
      if ($new_rlim->rlim_cur > l)
        {
          $new_rlim->rlim_cur = l;
          printf("setrlimit clamped process %s(%d) STACK rlim_cur to %p\n",
                 execname(), pid(), l)
        }
    }
}
    