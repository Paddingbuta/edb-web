{
    "bugid": "1076676",
    "cveid": [
        "CVE-2014-2497"
    ],
    "summary": "CVE-2014-2497 gd: NULL pointer dereference in gdImageCreateFromXpm()",
    "alias": "CVE-2014-2497",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "",
    "reported_date": "2014-03-14 19:57 UTC byVincent Danen",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=874847"
    ],
    "comment": [
        "It was reported [1] that the gdImageCreateFromXpm() function in libgd could dereference a NULL pointer, noting:\n\n\"The call to strlen() parses image.colorTable[i].c_color which is initialised as NULL if the particular color mapping uses a different key (such as monochrome/monovisual).\"\n\nThis was reported against PHP, which includes an embedded copy of the gd library.CVE-2014-2497was assigned to this issue [2].\n\n[1]https://bugs.php.net/bug.php?id=66901[2]http://seclists.org/oss-sec/2014/q1/580",
        "Note that the PHP bug includes a reproducer, but it does not seem to work with the versions I've tried (it notes version 5.4.17, I tried with 5.4.25 and 5.3.3):\n\n$ echo '<?php print imagecreatefromxpm(\"monochrome-poc.xpm\").\"\\n\"; ?>'|php\n\nWarning: imagecreatefromxpm(): 'monochrome-poc.xpm' is not a valid XPM file in - on line 1\n$ file monochrome-poc.xpm\nmonochrome-poc.xpm: X pixmap image text\n\nIt's possible that I did something wrong; I just cut-n-paste the reproducer from the upstream bug and I did not spend much time trying, so the bug is filed due to the CVE assignment.",
        "Createdattachment 874847[details]reproducer.xpm\n\nThis (correct) reproducer raise the segfault, tested with php 5.5.10 (and system gd 2.1).\n\nphp -r 'var_dump(imagecreatefromxpm(\"reproducer.xpm\"));'",
        "Thanks, Remi.  That is perfect.",
        "Based on this reproducer, this affects php53 on Red Hat Enterprise Linux 5, but not php (5.1) as it is not built with xpm support:\n\n% echo \"<?php var_dump(gd_info()); ?>\"|php\narray(12) {\n  [\"GD Version\"]=>\n  string(27) \"bundled (2.0.28 compatible)\"\n  [\"FreeType Support\"]=>\n  bool(true)\n  [\"FreeType Linkage\"]=>\n  string(13) \"with freetype\"\n  [\"T1Lib Support\"]=>\n  bool(false)\n  [\"GIF Read Support\"]=>\n  bool(true)\n  [\"GIF Create Support\"]=>\n  bool(true)\n  [\"JPG Support\"]=>\n  bool(true)\n  [\"PNG Support\"]=>\n  bool(true)\n  [\"WBMP Support\"]=>\n  bool(true)\n  [\"XPM Support\"]=>\n  bool(false)\n  [\"XBM Support\"]=>\n  bool(true)\n  [\"JIS-mapped Japanese Font Support\"]=>\n  bool(false)\n}\n% rpm -q php-gd\nphp-gd-5.1.6-43.el5_10",
        "Summary of what is affected:\n\n- php in Red Hat Enterprise Linux 5 is not affected (XPM support is disabled as noted incomment 4)\n- php53 in Red Hat Enterprise Linux 5, php in Red Hat Enterprise Linux 6, php54-php in Red Hat Software Collections 1, and php packages in Fedora are affected\n\n- gd in Red Hat Enterprise Linux 5 and 6, and gd packages in Fedora are affected\n\n- libwmf packages in Red Hat Enterprise Linux 5 and 6, and libwmf packages in Fedora are not affected.  Red Hat Enterprise Linux 5 libwmf packages have bundled gd built without xpm support.  The libwmf packages in Red Hat Enterprise Linux 6 and later (including Fedora) have the whole gdImageCreateFromXpm() disabled (#if 0) via the libwmf-0.2.8.4-reducesymbols.patch:http://pkgs.fedoraproject.org/cgit/libwmf.git/tree/libwmf-0.2.8.4-reducesymbols.patch?id=916cd2c#n467",
        "Statement:\n\nThis issue affects the versions of gd as shipped with Red Hat Enterprise Linux 5, 6, and 7. Red Hat Product Security has rated this issue as having Low security impact. A future update may address this issue. For additional information, refer to the Issue Severity Classification:https://access.redhat.com/security/updates/classification/.",
        "This issue has not been fixed in libgd version bundled in PHP.  It still seems to affect current upstream libgd 2.1.0, and there's no libgd upstream fix yet either.",
        "Created gd tracking bugs for this issue:\n\nAffects: fedora-all [bug 1080168]",
        "Created php tracking bugs for this issue:\n\nAffects: fedora-all [bug 1080167]",
        "GD upstream fix:https://bitbucket.org/libgd/gd-libgd/commits/463c3bd09bfe8e924e19acad7a2a6af16953a704PHP upstream fix (will be in 5.4.32, 5.5.16)http://git.php.net/?p=php-src.git;a=commit;h=cf4753691dc55999373d1c576f62ecb298723420",
        "gd-2.1.0-6.fc20 has been pushed to the Fedora 20 stable repository.  If problems still persist, please make note of it in this bug report.",
        "This is corrected in upstream PHP 5.5.16:http://php.net/ChangeLog-5.php#5.5.16",
        "php-5.5.16-1.fc19 has been pushed to the Fedora 19 stable repository.  If problems still persist, please make note of it in this bug report.",
        "IssueDescription:\n\nA NULL pointer dereference flaw was found in the gdImageCreateFromXpm() function of PHP's gd extension. A remote attacker could use this flaw to crash a PHP application using gd via a specially crafted X PixMap (XPM) file.",
        "This issue has been addressed in the following products:\n\n  Red Hat Enterprise Linux 6\n  Red Hat Enterprise Linux 5\n\nVia RHSA-2014:1326https://rhn.redhat.com/errata/RHSA-2014-1326.html",
        "This issue has been addressed in the following products:\n\n  Red Hat Enterprise Linux 7\n\nVia RHSA-2014:1327https://rhn.redhat.com/errata/RHSA-2014-1327.html",
        "This issue has been addressed in the following products:\n\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 7\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.5 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.4 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.6 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6\n\nVia RHSA-2014:1766https://rhn.redhat.com/errata/RHSA-2014-1766.html",
        "This issue has been addressed in the following products:\n\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 7\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.5 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.4 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6.6 EUS\n  Red Hat Software Collections 1 for Red Hat Enterprise Linux 6\n\nVia RHSA-2014:1765https://rhn.redhat.com/errata/RHSA-2014-1765.html",
        "Why does the gd-2.1.0-color_c_null_pointer.patch in Fedora match neither the PHP patch nor the upstream libgd patch?",
        "More importantly, Fedora patch introduces memory leak, afaics.  colors[] is not freed if the error is hit.  CCing patch author for comments.",
        "IIRC, the patch applied in Fedora was the one attached to the initial upstream bug report.\n\nYes this patch introduce a memory leak (while the upstream patch doesn't)\ngd 2.1.1 should have be released for a long time now :(\nI hope it will be very soon (some other important fix in this bugfix release).",
        "Thanks for spotting this. I have updated the fedora package to use upstream patch and tested it for memory leak.",
        "gd-2.1.0-8.fc21 has been pushed to the Fedora 21 stable repository.  If problems still persist, please make note of it in this bug report.",
        "gd-2.1.0-8.fc20 has been pushed to the Fedora 20 stable repository.  If problems still persist, please make note of it in this bug report."
    ]
}