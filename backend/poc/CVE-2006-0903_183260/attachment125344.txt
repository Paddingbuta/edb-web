#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <mysql/mysql.h>

int
main()
{
  MYSQL *mysql;
  MYSQL_RES *mres;
  char str[100];

  mysql = mysql_init(NULL);

  if (!mysql_real_connect(mysql, "localhost", "root", NULL, "test",
                          0, NULL, 0))
    {
      fprintf(stderr, "mysql_real_connect failed\n");
      exit(1);
    }

  /* use 0 to expose bug, another value such as 33 to see desired behavior */
  sprintf(str, "/* %c */ select 2+2", 0);
  if (mysql_real_query(mysql, str, 18))
    {
      fprintf(stderr, "mysql_real_query(%s) failed\n", str);
      exit(1);
    }

  mres = mysql_store_result(mysql);
  if (!mres)
    {
      fprintf(stderr, "mysql_store_result failed\n");
      exit(1);
    }

  printf("Got result of %d rows.\n", (int) mysql_num_rows(mres));

  mysql_free_result(mres);

  mysql_close(mysql);

  return 0;
}

