{
    "bugid": "435773",
    "cveid": [
        "CVE-2008-0887"
    ],
    "summary": "CVE-2008-0887 gnome-screensaver using NIS auth will unlock if NIS goes away",
    "alias": "CVE-2008-0887",
    "product": "Security Response",
    "hardware": "All",
    "os": "Linux",
    "url": "",
    "reported_date": "2008-03-03 19:57 UTC byAlan Matsuoka",
    "attachment": [
        "https://bugzilla-attachments.redhat.com/attachment.cgi?id=296671"
    ],
    "comment": [
        "Description of problem:\n\nIf a RHEL5.1 GNOME desktop is locked, and the authentication method is NIS,\nanyone can unlock the screen with no passwd if the network connection to the NIS\ndisappears or the NIS server is not available.\n\nHow reproducible:\n\nEvery time.\n\nSteps to Reproduce:\n\n1. Configure machine to be NIS server per:http://kbase.redhat.com/faq/FAQ_43_5684.shtm\n\n2. Configure a NIS client using system-config-authentication\n\n3. Login to GNOME desktop with NIS-only user.\n\n4. Lock the screen\n\n5. Stop the NIS server (customer disconnected network cable in his test)\n\n6. Press return in lock window.  Press cancel.  \n\n7. Screen unlocks with no passwd prompt.\n\nActual results:\n\nBroke in.\n\nExpected results:\n\nScreen should stay locked as there is no way to validate the user who is logged in.\n\nAdditional info:\n\nSimilar bug on RHEL4:https://bugzilla. redhat.com/show_bug.cgi?id=237003\n\nA similar bug was fixed on RHEL5:\n\n* Sun Oct 15 2006 Ray Strode <rstrode> - 2.16.0-13.el5\n- lock screen immediately if login security token was removed\n before startup (bug 210411)\n\nCustomer tested gnome-screensaver-2.16.1-6.el5 from FastTrack channel but had\nsame results.\n\nLog file from his gnome-screensaver session attached.\n\n\n\nSupporting Materials: Description of how to reproduce, log from\ngnome-screensaver. I've reproduced this on F8 and RHEL 5.1 as well, a sosreport\nis currently being generated from my RHEL 5.1 guest.\n\nMore Info:ore info...\n\nThe problem might be on any of the calls to getpwnam():\n\n File            Function              Line\n0 fusa-manager.c  fusa_manager_get_user 2272 pwent = getpwnam (username);\n1 gs-auth-pam.c   gs_auth_verify_user    651 pwent = getpwnam (username);\n2 gs-auth-pwent.c get_encrypted_passwd   143 struct passwd *p = getpwnam\n                                            (user);\n3 setuid.c        hack_uid               223 p = getpwnam (\"nobody\");\n4 setuid.c        hack_uid               224 if (! p) p = getpwnam\n                                            (\"noaccess\");\n5 setuid.c        hack_uid               225 if (! p) p = getpwnam (\"daemon\");\n\nTest program gets this error:\n#include <sys/types.h>\n#include <pwd.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nint main(char argc, char *argv[])\n{\n\nif (!getpwnam(\"rickb\"))\n       printf(\"error\");\n}\n\n./getpwnam\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = Connection refused\nYPBINDPROC_DOMAIN: Domain not bound\n\nIf NIS is down.\n\nIf those calls to getpwent() don't handle a NULL properly, we could be in\ntrouble if the return values are undefined.\n\nAdditional info:\n\nProblem may be that gnome-screenaver-dialog is exiting abnormally.   \n\nIf you attach with gdb to this process and set a breakpoint on exit, continue,\nthen shutdown the NIS server, you get this stack trace:\n\nProgram received signal SIGTERM, Terminated.\n[Switching to Thread 46912496279280 (LWP 10062)]\n0x00000038cb40dd4d in raise () from /lib64/libpthread.so.0\n(gdb) bt\n#0  0x00000038cb40dd4d in raise () from /lib64/libpthread.so.0\n#1  0x000000000040e529 in g_cclosure_marshal_VOID__OBJECT ()\n#2  0x0000000000408889 in g_cclosure_marshal_VOID__OBJECT ()\n#3  0x00000038cd42cf44 in g_main_context_dispatch ()\n  from /lib64/libglib-2.0.so.0\n#4  0x00000038cd42fd7d in g_main_context_check () from /lib64/libglib-2.0.so.0\n#5  0x00000038cd43008a in g_main_loop_run () from /lib64/libglib-2.0.so.0\n#6  0x00000038d712aad3 in gtk_main () from /usr/lib64/libgtk-x11-2.0.so.0\n#7  0x00000000004085c1 in g_cclosure_marshal_VOID__OBJECT ()\n#8  0x00000038ca81d8a4 in __libc_start_main () from /lib64/libc.so.6\n#9  0x00000000004082d9 in g_cclosure_marshal_VOID__OBJECT ()\n#10 0x00007ffff53660e8 in ?? ()\n#11 0x0000000000000000 in ?? ()\n\n\n(gdb) info thread\n 2 Thread 1084229952 (LWP 10063)  0x00000038ca8c5d16 in poll ()\n  from /lib64/libc.so.6\n* 1 Thread 46912496279280 (LWP 10062)  0x00000038cb40dd4d in raise ()\n  from /lib64/libpthread.so.0\n\n\nOnce this happens, the process terminates.",
        "Createdattachment 296671[details]screensaver log",
        "Createdattachment 297817[details]patch for upstream svn / rawhide",
        "This does not appear to affect xscreensaver.  I'm not able to reproduce this as\ndescribed above.",
        "It would affect xscreensaver in a slightly different way (but I have not\nconfirmed this).  If the network drops between login and the time that the\nscreensaver starts (or anytime it restarts) it won't lock the screen.  So it\nisn't as severe but still probably not what you expect.",
        "I just tested this, xscreensaver does still lock the screen.",
        "I just tested xscreensaver on Fedora 8 and this is what happens if the network\ndisconnects before xscreensaver starts:\nxscreensaver -verbose\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = No route to host\nYPBINDPROC_DOMAIN: Domain not bound\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = No route to host\nYPBINDPROC_DOMAIN: Domain not bound\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = No route to host\nYPBINDPROC_DOMAIN: Domain not bound\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = No route to host\nYPBINDPROC_DOMAIN: Domain not bound\ndo_ypcall: clnt_call: RPC: Unable to receive; errno = No route to host\nYPBINDPROC_DOMAIN: Domain not bound\nCould not figure out who the current user is!\n[exits]",
        "So I tried that on RHEL[234].  xscreensaver will start without the network (it\ndoes take quite a long time though).  If it's already running it will lock the\nscreen fine.",
        "***Bug 437957has been marked as a duplicate of this bug. ***",
        "embargo was agreed as apr02 with vendor-sec; removing embargo.",
        "gnome-screensaver-2.18.2-4.fc7 has been submitted as an update for Fedora 7",
        "gnome-screensaver-2.20.0-12.fc8 has been submitted as an update for Fedora 8",
        "gnome-screensaver-2.18.2-4.fc7 has been pushed to the Fedora 7 stable repository.  If problems still persist, please make note of it in this bug report.",
        "gnome-screensaver-2.20.0-12.fc8 has been pushed to the Fedora 8 stable repository.  If problems still persist, please make note of it in this bug report."
    ]
}